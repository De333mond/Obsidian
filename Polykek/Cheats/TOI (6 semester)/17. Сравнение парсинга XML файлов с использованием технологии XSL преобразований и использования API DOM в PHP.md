#Polykek/cheats/TOI #XSL-XML 

### Общие сведения о языке XML
\
XML (англ. eXtensible Markup Language — расширяемый язык разметки) Был создан не для форматирования и отображения данных, а для их описания. XML можно рассматривать как альтернативу базы данных. XML имеет текстовый формат При создании XML документов используются собственные элементы (теги) в соответствии со сводом синтаксических правил. Таким образом, XML представляет собой свод общих синтаксических правил.

#### Синтаксис XML


Стандартом определены два уровня правильности документа XML: 
• Правильно оформленный XML-документ (Well-formed) 
• Действительный документ (Valid)

Правильно оформленный XML-документ соответствует всем общим правилам синтаксиса XML, применимым к любому XML-документу. Если, например, начальный тег не имеет соответствующего ему конечного тега, то это неправильно построенный документ XML.

Действительный XML-документ дополнительно соответствует некоторым семантическим правилам, установленным для конкретной реализации языка на основе свода общих синтаксических правил XML.

акие семантические правила хранятся в специальных файлах — схемах, где описана структура документа, все допустимые названия элементов, атрибутов и многое другое. И если документ, например, содержит не определённое заранее в схемах название элемента, то XMLдокумент считается недействительным

Критерии правильности XML-документа 
1. Все теги должны быть парными
   Для пустого тега допустимо Все, что заключено между начальным и конечным тегом элемента включая, сами теги называется XML-элементом.
2. Теги не могут перекрывать друг друга.
3. Элемент может:
   - иметь элементное содержимое (содержать дочерние элементы).  
   - иметь текстовое содержимое.
   - иметь смешанное содержимое
   - быть пустым
4. Имена элементов должны подчиняться соглашениям:
   - Названия могут содержать буквы, цифры и другие символы 
   - Названия не могут начинаться с цифры, знака препинания или букв xml 
   - Названия не должны содержать пробелы 
   - Названия из символов разных регистров есть разные названия. (Teg и teg).
5. Элементы XML могут содержать атрибуты.
   Атрибут — это пара «имя=значение» в открывающем теге элемента. Атрибут должен иметь значение в одинарных или двойных кавычках, даже если это пустая строка.
6. Комментарий может быть размещен в любом месте дерева. XML комментарии размещаются внутри пары тегов . Два знака дефис (--) не могут быть применены ни в какой части внутри комментария
7. Особые символы
   Некоторые символы не могут быть корректно обработаны и должны быть заменены ссылками на сущности. Ссылки на сущности всегда начинаются с амперсанда и заканчиваются точкой с запятой.
   
   Полный список предопределённых сущностей состоит из 
   - &amp; (&),
   - &lt; (<), 
   - &gt; (>),
   - &apos; (') 
   - &quot; (")
8. CDATA (Character DATA) – символьные данные Если содержимое XML-элемента содержит множество особых символов (например, программный код), то сделать секцию CDATA. Все, что находится внутри секции не анализируется обработчиком (парсером).
```
<script>
<![CDATA[
function matchwo(a,b)
{
 if (a < b && a < 0)
 {
 return 1
 } else
{
 return 0
}
]]>
</script>
```

9. Процессуальная инструкция (инструкция по обработке вкладываемого в нее текста) Имеет следующую форму записи: Инструкция передается приложению, указанному в начале. Примеры:
   `<?xml-stylesheet type="text/xsl" href="stil.xsl"?>`

Инструкция предназначена парсеру и указывает на необходимость подключения файла стилевых таблиц stil.xsl и обработки XMLдокумента с помощью этого подключенного файла.

### Отображение XML документов 
XML-документ не содержит указаний на то, как его следует отображать. Отображение можно выполнять несколькими способами. Наиболее удобными на сегодняшний день являются: 
• Использование языка XSL. 
• Использование интерфейса DOM (API DOM) в PHP5

## Способы XSL преобразования XML – документа

Преобразование XML-документа может выполняться двумя способами: 
• преобразователем (парсером) браузера на локальной машине 
• на сервере, например, средствами языка PHP, а браузеру отправляться HTML код.

Локальное преобразование 
Для реализации первого способа на локальной машине необходимы два файла: 
• XML – документ 
• Файл с таблицей стилей XSL 

В файле XML-документа должна содержаться ссылка на стилевой файл. Загрузка XML – документа приводит к генерации кода в соответствии с XSLT инструкциями и отображению полученного кода.

Серверное преобразование Необходимы три файла: 
• XML - документ 
• XSL - таблица 
• PHP- скрипт 

XML – документ и XSL файл хранятся на сервере. XML – документ не содержит ссылку на стилевой файл XSL. PHP- скрипт загружает XML – документ, XSL – таблицe и запускает преобразование. Для реализации этих процедур необходимо подключение и использование библиотеки php_xsl.dll

## Использование интерфейса DOM (API DOM) в PHP5

Объектная модель документа 
Объектная модель документа (Document Object Model, DOM) представляет собой дерево отображающее структуру XML — документа. DOM создается обработчиком (парсером). 

Для работы с DOM используется интерфейс DOM (API DOM). В PHP5 в качестве API DOM выступает встроенная библиотека DOM функций.

Узлы XML - документа могут относиться к разным типам.


| NodeType тип узла | NodeTypeString строковое значение типа узла | NodeName имя узла | NodeValue значение узла |
| ----------------- | ------------------------------------------- | ----------------- | ----------------------- |
| 1                 | element                                     | Имя тега          | null                    |
| 2                 | attribute                                   | Имя атрибута      | Значение атрибута       |
| 3                 | text                                        | \#text            | Содержимое узла         |
| 4                 | cdatasection                                | \# cdatasection   | Содержимое узла         |
| 8                 | comment                                     | \#comment         | Текст комментария       |
| 9                 | document                                    | \# document       | null                    |

## Объекты DOM
Для моделирования узлов и работы с ними в DOM используются следующие объекты:
- Node 
- NodeList 
- Document 
- Element 
- Attr

Объект Node Объект Node моделирует любой узел дерева узлов.

| **Имя**                                      | **Описание**                                                                                                        |
| -------------------------------------------- | ------------------------------------------------------------------------------------------------------------------- |
| attributes                                   | Возвращает NamedNodeMap (карта именованных узлов), содержащий все атрибуты узла                                     |
| childNodes                                   | Возвращает NodeList (список узлов), содержащий список всех дочерних узлов данного узла                              |
| firstChild                                   | Возвращает первый дочерний узел данного узла                                                                        |
| lastChild                                    | Возвращает последний дочерний узел данного узла                                                                     |
| nextSibling                                  | Возвращает следующий узел, дочерний элемент того же родительского узла                                              |
| nodeName                                     | Возвращает nodeName (имя узла) в зависимости от его типа                                                            |
| nodeType                                     | Возвращает nodeType (тип узла) в виде числа                                                                         |
| nodeValue                                    | Возвращает или устанавливает значение данного узла в зависимости от его типа                                        |
| parentNode                                   | Возвращает родительский узел данного узла                                                                           |
| previousSibling                              | Возвращает предыдущий дочерний элемент, обладающий тем же родительским элементом, что и данный                      |
| appendChild (newCild)                        | Привязывает новый узел newChild как последний в списке дочерних узлов данного узла                                  |
| hasChildNodes ()                             | Возвращает значение true, если узел имеет хотя бы один дочерний узел                                                |
| insertBefore (newNode, refNode)              | Вставляет новый узел, newNode, перед существующим узлом refNode                                                     |
| removeChild (nodeName)                       | Удаляет определенный узел nodeName (имя узла)                                                                       |
| replaceChild (newNode, oldNode)              | Заменяет старый узел oldNode новым узлом newNode                                                                    |
| lenght                                       | Возвращает число узлов в списке NodeList                                                                            |
| item                                         | Возвращает заданный узел из списка NodeList                                                                         |
| documentElement                              | Возвращает корневой элемент документа                                                                               |
| createAttribute (attributeName)              | Создает узел attribute с заданным именем атрибута                                                                   |
| createElement (tagname)                      | Создает элемент с заданным именем тега                                                                              |
| createProcessingInstruction (target, text)   | Создает узел процессуальных инструкций ProcessingInstruction, содержащий заданную цель и текст                      |
| getElementById (id)                          | Возвращает элемент, значение id которого указано в аргументе                                                        |
| getElementByTagName (tagName)                | Возвращает заданный узел и все его дочерние узлы в виде списка узлов nodeList                                       |
| tagName                                      | Возвращает или устанавливает имя узла                                                                               |
| getAttribute (attributeName)                 | Возвращает значение заданного атрибута                                                                              |
| getAttributeNode (attributeName)             | Возвращает заданный узел- атрибут как объект                                                                        |
| getElementsByTagName (tagName)               | Возвращает заданный узел и все его дочерние узлы в виде списка узлов nodeList                                       |
| removeAttribute (attributeName)              | Удаляет значение заданного атрибута. Если атрибутный узел имеет значение по умолчанию, этот атрибут вставляется     |
| removeAttributeNode (attributeNode)          | Удаляет заданный атрибутный узел.<br><br>Если атрибутный узел имеет значение по умолчанию, этот атрибут вставляется |
| setAttribute (attributeName, attributeValue) | Вставляет новый атрибут                                                                                             |
| setAttributeNode (attributeNodeName)         | Вставляет новый атрибутный узел                                                                                     |
| name                                         | Возвращает или устанавливает имя атрибута                                                                           |
| value                                        | Возвращает или устанавливает значение атрибута                                                                      |
## API DOM для работы с XML – документом в PHP5
API DOM предоставляет набор классов и методов для работы с рассмотренными выше объектами DOM.

Имена классов совпадают с именами объектов DOM с приставкой DOM.

Например:
Для объектов NodeList имеется класс DOMNodeList Для объектов Document имеется класс DOMDocument

_Создание HTML-документа с помощью DOM-функций_

```php
<?php
$dom = new DOMDocument("1.0");

// Создаем и подключаем к списку элементы html, head, title и

$root = $dom->appendChild($dom->createElement("html"));
$head = $root->appendChild($dom->createElement("head"));
$title = $head->appendChild($dom->createElement("title"));
$body = $root->appendChild($dom->createElement("body"));

// Создаем и подключаем процессуальную инструкцию с кодом PHP внутри.

$body->appendChild( $dom->createProcessingInstruction('php', 'echo date("Y-m-d");?'));

// Создаем и подключаем элементы br и hr.

$body->appendChild($dom->createElement("br"));
$body->appendChild($dom->createElement("hr"));

// Создаем атрибут id со значением 123

$body->setAttribute('id', '123');

// Создаем и подключаем текстовый узел "Our_document",
// являющийся содержанием узла title.

$title->appendChild($dom->createTextNode("Our_document"));
 
// Сохраняем результат в файле 1.php

if ($dom->saveHTMLFile('1.php')) echo "Файл успешно создан!";
?>
```

